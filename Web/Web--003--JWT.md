# JWT(Json Web Token)
- JWT는 유저를 인증하고 식별하기 위한 토큰(Token)기반 인증이다.
- 토큰은 세션과는 달리 서버가 아닌 클라이언트에 저장되기 때문에 메모리나 스토리지 등을 통해 세션을 관리했던 서버의 부담을 덜 수 있다.
- JWT는 토큰 자체에 사용자의 권한 정보나 서비스를 사용하기 위한 정보가 포함된다.
- 데이터가 많아지면 토큰이 커질 수 있으며 토큰이 한 번 발급된 이후 사용자의 정보를 바꾸더라도 재발급하지 않는 이상 반영되지 않는다.

### JWT의 특징
- JWT를 사용하면 RESTful과 같은 무상태(Stateless)인 환경에서 사용자 데이터를 주고 받을 수 있게 된다.
- JWT와 같은 토큰을 클라이언트에 저장하고 요청시 단순히 HTTP 헤더에 토큰을 첨부하는 것만으로도 단순하게 데이터를 요청하고 응답을 받아올 수 있다.

### JWT 사용 순서
1. 클라이언트 사용자가 아이디, 패스워드를 통해 웹서비스 인증한다.
2. 서버에 서명된 JWT를 생성하여 클라이언트에 응답으로 돌려준다.
3. 클라이언트가 서버에 데이터를 추가적으로 요구할 때 JWT를 HTTP Header에 첨부한다.
4. 서버에서 클라이언트로부터 온 JWT를 검증한다.

### JWT 구조
- JWT는 Header, Payload, Signature의 3부분으로 이루어지며, JSON 형태인 각 부분은 Base64로 인코딩되어 표현된다.
- 각각의 부분을 이어주기 위해 . 구분자를 사용하여 구분한다.

##### 헤더(Header)
- Header는 두 가지의 정보를 지니고 있다.
- typ : 토큰의 타입을 지정한다. 바로 JWT를 말하는 것이다.
- alg : Signature 해싱 알고리즘을 지정한다. 해싱 알고리즘으로는 보통 HMAC-SHA256 혹은 RSA가 사용되며, 이 알고리즘은 토큰을 검증할 때 사용되는 Signature 부분에서 사용된다.

##### 정보(Payload)
- Payload 부분에는 토큰에 담을 정보가 들어있다.
- 여기에 담는 정보의 한 조각을 클레임(Claim)이라고 부르고, 이는 JSON 형태의 한 쌍으로 이루어져 있다.
- 클레임의 종류는 다음과 같이 크게 세 분류로 나뉘어진다 -> 등록된(Registered) 클레임, 공개(Public) 클레임, 비공개(Private) 클레임

##### 서명(Signature)
- 서명은 토큰을 인코딩하거나 유효성 검증을 할 때 사용하는 고유한 암호화 코드이다.
- 서명은 위에서 만든 헤더와 페이로드의 값을 각각 BASE64로 인코딩하고, 인코딩한 값을 비밀 키를 이용해 헤더에서 정의한 알고리즘으로 해싱을 하고, 이 값을 다시 BASE64로 인코딩하여 생성한다.
- 생성된 토큰은 HTTP 통신을 할 때 Authorization이라는 Key의 Value로 사용된다. 일반적으로 Value에는 Bearer가 앞에 붙여진다.

### JWT의 장점
- 사용자 인증에 필요한 모든 정보는 토큰 자체에 포함하기 때문에 별도의 인증 저장소가 필요 없다.
- 쿠키를 전달하지 않아도 되므로 쿠키를 사용함으로써 발생하는 취약점이 사라진다.
- URL 파라미터와 헤더로 사용한다.
- 트래픽에 대한 부담이 낮다.
- REST 서비스로 제공이 가능하다.

### JWT의 단점
- 토큰 자체에 정보를 담고 있으므로 양날의 검이 될 수 있다.
- 토큰의 페이로드에 3종류의 클레임을 저장하기 때문에, 정보가 많아질수록 토큰의 길이가 늘어나 네트워크에 부하를 줄 수 있다.
- 페이로드 자체는 암호화된 것이 아니라, BASE64로 인코딩 된 것이다. 중간에 페이로드를 탈취하여 디코딩하면 데이터를 볼 수 있으므로, JWE로 암호화하거나 페이로드에 중요 데이터를 넣지 않아야 한다.
- JWT는 상태를 저장하지 않기 때문에 한 번 만들어지면 제어가 불가능하다. 토큰을 임의로 삭제하는 것이 불가능하므로 토큰 만료 시간을 꼭 넣어주어야 한다.
- 토큰은 클라이언트 측에서 관리해야 하기 때문에 토큰을 저장해야만 한다.
